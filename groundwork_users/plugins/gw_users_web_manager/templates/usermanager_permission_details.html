{% extends "base.html" %}
{% block content %}
<h1>{{_('Permission')}} <small>{{ permission.name }}</small></h1>
{{_('This list shows all registered permissions.')}}

<table class="table table-striped table-bordered">
    <colgroup>
        <col width="150">
        <col/>
    </colgroup>
    <tr>
        <td><strong>{{_('Name')}}</strong></td>
        <td>{{permission.name}}</td>
    </tr>
    <tr>
        <td><strong>{{_('Plugin')}}</strong></td>
        <td>{{permission.plugin}}</td>
    </tr>
    <tr>
        <td><strong>{{_('Description')}}</strong></td>
        <td>{{permission.description}}</td>
    </tr>
    <tr>
        <td><strong>{{_('Function')}}</strong></td>
        <td>{{permission.func.__name__}}</td>
    </tr>
    <tr>
        <td><strong>{{_('Parameters')}}</strong></td>
        <td>
            {%  if permission.params is not none %}
                {%  for param in permission.params %}
            <b>{{ param.name}}</b>: {{ param.description }}<br>
                {% endfor %}
            {% endif %}
        </td>
    </tr>
    <tr>
        <td><strong>{{_('User (direct)')}}</strong></td>
        <td>
            <ul>
                {%  for user in permission_db.users %}
                <li><a href="{{url_for('.view_usermanager_detail', user=user.user)}}">{{user.name}}</a></li>
                {% endfor %}
            </ul>
        </td>
    </tr>
    <tr>
        <td><strong>{{_('Roles')}}</strong></td>
        <td>
            <ul>
                {%  for role in permission_db.roles %}
                <li><a href="{{url_for('.view_roles_details', role_name=role.name)}}">{{role.name}}</a></li>
                {% endfor %}
            </ul>
        </td>
    </tr>
    <tr>
        <td><strong>{{_('Users (via roles)')}}</strong></td>
        <td>
            <ul>
                {%  for role in permission_db.roles %}
                    {%  for user in role.users%}
                <li><a href="{{url_for('.view_usermanager_detail', user=user.user)}}">{{user.name}}</a></li>
                    {% endfor %}
                {% endfor %}
            </ul>
        </td>
    </tr>
    <tr>
        <td>
            <strong>{{_('Secured Routes')}}</strong></br>
            <small>Shows only routes secured by decorator "permission_required" and "permission_allowed".</small>
        </td>
        <td>
            <table class="table table-striped table-bordered">
                 <thead>
                    <tr>
                        <th>{{_('Route')}}</th>
                        <th>{{_('Plugin')}}</th>
                        <th>{{_('Decorator')}}</th>
                        <th>{{_('All Parameters')}}</th>
                    </tr>
                </thead>
                <tbody>
                    {%  for route in routes %}
                    <tr>
                        <td>
                            {% if route["type"] == "rest" %}
                            <a href="{{url_for('pluginmanager.plugin_rest_details_view', plugin=route["plugin"], route=route["name"]|replace("/","%2f"))}}">
                            {% else %}
                            <a href="{{url_for('pluginmanager.plugin_route_details_view', plugin=route["plugin"], route=route["name"]|replace("/","%2f"))}}">
                            {%  endif %}
                                {{ route["name"] }}
                            </a>
                        </td>
                        <td>
                            <a href="{{url_for('pluginmanager.plugin_details_view', plugin=route["plugin"])}}">
                            {{ route["plugin"] }}
                        </td>
                        <td>
                            <a href="{{url_for('pluginmanager.plugin_decorator_details', decorator=route["decorator"])}}">
                            {{ route["decorator"] }}
                        </td>
                        <td>
                            <ul>
                            {%  for parameter in route["parameters"] %}
                                <li>{{ parameter}}</li>
                            {%  endfor %}
                            </ul>
                        </td>
                    </tr>
                    {%  endfor %}
                </tbody>
            </table>
        </td>
    </tr>
</table>
{% endblock %}
